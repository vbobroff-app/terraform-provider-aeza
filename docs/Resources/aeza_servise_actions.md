# **Resources**
### **aeza_service_actions**
Управляет операциями управления услугами в аккаунте Aeza. Ресурс позволяет включать, выключать и перезагружать VPS, выделенные серверы* и другие услуги*.<br>*- *в разработке*

### **Схема ресурса**
**Обязательные параметры**

| Поле | Тип | Обязательный | Описание |
|------|-----|-------------|-----------|
| `service_id` | number | ✅ | ID услуги для управления |

**Опциональные параметры**

| Поле | Тип | Обязательный | Описание |
|------|-----|-------------|-----------|
| `is_active` | boolean | ❌ | Состояние питания услуги (true - включено, false - выключено). По умолчанию: true |
| `restart` | boolean | ❌ | Перезагрузка услуги. По умолчанию: false |

**Вычисляемые поля (только для чтения)**

| Поле | Тип | Описание |
|------|-----|-----------|
| `id` | number | ID услуги (совпадает с service_id) |


### **Примечания:**

- Ресурс интеллектуально проверяет текущий статус услуги перед выполнением операций

- Операция выполняется только если текущий статус не совпадает с желаемым состоянием

- Перезагрузка (restart) выполняется только если услуга активна

- Все операции идемпотентны - повторное применение с теми же параметрами не вызовет лишних API запросов

Использует [V2 API /api/v2/services/{id}/ctl/{action}]() ендпоинты.

### **Примеры использования**
#### Выключение услуги
```hcl
# Создание VPS
resource "aeza_service" "test_vps" {
  name        = "my-vps"
  product_id  = 182
  payment_term = "hour"
}

# Выключение услуги
resource "aeza_service_actions" "power_off" {
  service_id = aeza_service.test_vps.id
  is_active  = false  # Выключить сервис
}

# Проверка состояния
output "service_state" {
  value = aeza_service_actions.power_off.id
}
```

#### Включение и перезагрузка услуги
```hcl
resource "aeza_service_actions" "power_management" {
  service_id = aeza_service.production.id
  is_active  = true   # Включить сервис
  restart    = true   # Выполнить перезагрузку
}
```
#### Только перезагрузка активной услуги
```hcl
resource "aeza_service_actions" "reboot_only" {
  service_id = aeza_service.vps.id
  # is_active = true (по умолчанию - услуга остается включенной)
  restart    = true   # Выполнить перезагрузку
}
```
#### Автоматическое управление состоянием
```hcl
# Включение услуги при развертывании
resource "aeza_service_actions" "start_for_deployment" {
  service_id = aeza_service.app_server.id
  is_active  = true
}

# Выключение при очистке
resource "aeza_service_actions" "shutdown_for_cleanup" {
  service_id = aeza_service.temp_server.id
  is_active  = false
}
```

### **Логика выполнения операций**
#### Для is_active
- Если is_active = true и услуга выключена (suspended) → выполняется resume

- Если is_active = false и услуга активна (active) → выполняется suspend

- Если статус уже соответствует желаемому состоянию → операция пропускается

#### Для restart
- Если restart = true и услуга активна (active) → выполняется restart

- Если услуга не активна → перезагрузка пропускается с предупреждением


### **Ограничения**
- Ресурс не может быть импортирован (управляет операциями, а не состоянием)

- Для операций управления требуется чтобы услуга существовала и была доступна

- Перезагрузка возможна только для активных услуг

- Удаление ресурса из конфигурации не отменяет выполненные операции

Использует [V2 API](../API/api.md) который возвращает статус 201 Created при успешном выполнении

